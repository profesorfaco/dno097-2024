<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Calma - Música & Emociones</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet" />
    <link href="style.css" rel="stylesheet"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/chartist@0.11.4/dist/chartist.min.css">
</head>
<body>
<nav class="navbar fixed-top navbar-expand-lg navbar-dark bg-dark shadow">
    <div class="container">
        <a class="navbar-brand" href="index.html">Música & Emociones</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarsExample07XL" aria-controls="navbarsExample07XL" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse">
            <ul class="navbar-nav ms-auto">
                <li class="nav-item">
                    <a class="nav-link" aria-current="page" href="pagina-alegria.html"><span style="color:var(--color-alegria)">●</span> Alegría</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link active" href="pagina-calma.html"><span style="color:var(--color-calma)">●</span> Calma</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="pagina-confianza.html"><span style="color:var(--color-confianza)">●</span> Confianza</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="pagina-ira.html"><span style="color:var(--color-ira)">●</span> Ira</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="pagina-tristeza.html"><span style="color:var(--color-tristeza)">●</span> Tristeza</a>
                </li>                             
            </ul>
        </div>
    </div>
</nav>
<header class="calma">
    <div class="container">
        <h1>Calma</h1>
    </div>
</header>

<div class="container">
    <div class="row">
        <div class="col-md-7 mx-auto">
            <p class="lead">Las notas suaves y tranquilas de la música de serenidad calman el espíritu generando paz y relajación. Este análisis nos dará a entender características que definen una canción como relajante.</p>

            <!--desde aquí, hacia abajo, debes seguir arreglando-->

            <h2 class="my-5">Top 10 Canciones de Calma</h2>
            <div class="table-responsive">
                <table class="table table-dark table-striped table-hover">
                    <thead>
                        <tr>
                            <th scope="col">#</th>
                            <th scope="col">Nombre de la Canción</th>
                            <th scope="col">Artista</th>
                        </tr>
                    </thead>
                    <tbody id="topSongsTableBody">
                    </tbody>
                </table>
            </div>
        </div>
    </div>


<div class="container-fluid content">
        <div class="row justify-content-center">
            <div class="col-md-9">
                <div class="card my-2 shadow-sm text-center" style="background-color: #262626;">    
                    <div class="card-header " style="background-color: #262626">
                        <p>Popularidad de canciones que <strong>CALMAN</strong> de cada año</p>
                    </div>
                    <div class="card-body position-relative" style="background-color: #262626;">
                        <p class="y-label position-absolute start-0 top-50">Popularidad</p>
                        <div class="ct-chart ct-chart-a ct-major-twelfth"></div>
                    </div>
                    <p>Años</p>
                </div>
                <div class="align text-center">
                    <p1 class="text-center"> 
                        La música activa el sistema de recompensa, demostrando su capacidad para generar emociones placenteras de manera significativa. (Salimpoor et al., 2011).
                    </p1>
                </div>
            </div>


            <div class="col-md-9">
                <div class="card my-2 shadow-sm text-center" style="background-color: #262626;">    
                    <div class="card-header" style="background-color: #262626">
                        <p>Cantidad de <strong>GÉNEROS</strong> involucrados en la emoción</p>
                    </div>
                    <div class="card-body position-relative" style="background-color: #262626;">
                        <p class="y-label position-absolute start-0 top-50">Cantidad</p>
                        <div class="ct-chart ct-chart-b ct-major-twelfth"></div>
                    </div>
                     <p>Generos</p>
                </div>
                <div class="align text-center">
                    <p1 class="text-center">
                        La diversidad de géneros musicales que contribuyen a la emoción de la calma es un testimonio de la riqueza y la adaptabilidad del arte musical.
                </div>
            </div>

            <div class="col-md-9">
                <div class="card my-2 shadow-sm text-center" style="background-color: #262626;">    
                    <div class="card-header" style="background-color: #262626">
                        <p>Relación entre <strong>ENERGY & VALENCE</strong> de la música de calma</p>
                    </div>
                    <div class="card-body position-relative" style="background-color: #262626;">
                        <p class="y-label position-absolute start-0 top-50">Valence</p>
                        <div class="ct-chart ct-chart-c ct-major-twelfth"></div>
                    </div>
                     <p>Energy</p>
                </div>
                <div class="align text-center">
                    <p1 class="text-center">
                       Según Eerola et al. (2013), establecieron una jerarquía de parámetros musicales donde el modo fue el más relevante, seguido por tempo, registro, dinámica, articulación y timbre, encontrando que esta clasificación varía según la emoción.
                    </p1>
                </div>
            </div>

            <div class="col-md-9">
                <div class="card my-2 shadow-sm text-center" style="background-color: #262626;">    
                    <div class="card-header" style="background-color: #262626">
                        <p>Cantidad de canciones con <strong>CONTENIDO EXPLICITO Y SIN CONTENIDO EXPLICITO</strong> involucrados en la emoción de calma en cada año</p>
                    </div>
                    <div class="card-body position-relative" style="background-color: #262626;">
                        <p class="y-label position-absolute start-0 top-50">Cantidad</p>
                        <div class="ct-chart ct-chart-d ct-major-twelfth"></div>
                    </div>
                    <div class="legend">
                        <div class="legend-item">
                            <div class="legend-color-1"></div>
                            <div class="legend-text">Contenido NO explicito</div>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color-2"></div>
                            <div class="legend-text">Contenido explicito</div>
                        </div>
                    </div>

                </div>
                <div class="align text-center">
                    <p1 class="text-center"> 
                        Las etiquetas emocionales varían culturalmente debido a diferencias lingüísticas, lo que subraya la diversidad cultural (Argstatter, 2016).
                    </p1>
                </div>
            </div>
        </div>
    </div>
</p1><!--que es esto??-->
</div>
</div>
</div>
</div>
</div>
<!--hasta aquí tienes que arreglar-->

        <footer>
            <div class="container">
                <div class="row">
                    <div class="col pt-5 pb-3 text-center">
                        <p class="d-flex justify-content-between align-items-center small m-0 p-0">
                            <a href="https://github.com/camivallejo" class="link-light link-underline-opacity-25 link-underline-opacity-75-hover">Camila Vallejos</a>
                            <a href="https://github.com/profesorfaco/dno097-2024" class="link-light link-underline-opacity-25 link-underline-opacity-75-hover">
                                <span class="d-none d-md-inline">Desarrollo web y diseño visual de información</span><span class="d-md-none">DNO097</span>
                            </a>
                            <a href="https://diseno.uc.cl/" class="link-light link-underline-opacity-25 link-underline-opacity-75-hover">Diseño UC</a>
                        </p>
                    </div>
                </div>
            </div>
        </footer>

        <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.0/papaparse.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/chartist@0.11.4/dist/chartist.min.js"></script>

        <script>
document.addEventListener('DOMContentLoaded', function() {
    Papa.parse("img/DATASET_SPOTIFY.csv", {
        download: true,
        header: true,
        dynamicTyping: true,
        complete: function(results) {
            const csvData = results.data;
            console.log(csvData);

                    const emotion = {
                        "emocion": "calma",
                        "danceability": 640,
                        "energy": 500,
                        "key": 5,
                        "loudness": -6.332,
                        "mode": 1,
                        "speechiness": 400,
                        "acousticness": 353,
                        "instrumentalness": 0.00618,
                        "liveness": 770,
                        "valence": 371,
                        "tempo": 100.202
                    };                    

                    const thresholds = {
                        danceability: 200,
                        energy: 300,
                        key: 7,
                        loudness: 10,
                        mode: 1,
                        speechiness: 250,
                        acousticness: 300,
                        instrumentalness: 0.15,
                        liveness:150,
                        valence: 100,
                        tempo: 90
                    };

            let relatedSongs = csvData.filter(song => {
                return Object.keys(emotion).every(key => {
                    if (key !== 'emocion') {
                        return Math.abs(parseFloat(song[key]) - emotion[key]) < thresholds[key];
                    }
                    return true;
                });
            });

            console.log("Related songs:", relatedSongs);

            const popularityByYear = {};
            relatedSongs.forEach(song => {
                const year = song.year.toString();
                if (!popularityByYear[year]) {
                    popularityByYear[year] = [];
                }
                popularityByYear[year].push(song.popularity);
            });

            const labels1 = Object.keys(popularityByYear);
            const series1 = labels1.map(year => {
                const popularityValues = popularityByYear[year];
                const sum = popularityValues.reduce((acc, val) => acc + val, 0);
                return sum / popularityValues.length; 
            });

            new Chartist.Line('.ct-chart-a', {
                labels: labels1,
                series: [series1]
            }, {
                showPoint: true,
                axisX: {
                    title: {
                        text: 'Año'
                    }
                },
                axisY: {
                    title: {
                        text: 'Popularidad Promedio'
                    }
                }
            });

            const genreCounts = {};
            relatedSongs.forEach(song => {
                const genres = song.genre.split(',');
                genres.forEach(genre => {
                    genre = genre.trim();
                    if (!genreCounts[genre]) {
                        genreCounts[genre] = 0;
                    }
                    genreCounts[genre]++;
                });
            });

            const labels2 = Object.keys(genreCounts);
            const series2 = [Object.values(genreCounts)];

            new Chartist.Bar('.ct-chart-b', {
                labels: labels2,
                series: series2
            }, {
                seriesBarDistance: 15,
                axisX: {
                    offset: 60,
                    title: 'Género'
                },
                axisY: {
                    offset: 80,
                    title: 'Cantidad'
                }
            });

            const sortedRelatedSongs = relatedSongs.sort((a, b) => a.energy - b.energy);
            const labels3 = sortedRelatedSongs.map(song => song.energy.toString());
            const series3 = [sortedRelatedSongs.map(song => song.valence)];
            console.log("Related songs:", relatedSongs);

            new Chartist.Line('.ct-chart-c', {
                labels: labels3,
                series: series3
            }, {
                showLine: false,
                axisX: {
                    title: {
                        text: 'Energy'
                    }
                },
                axisY: {
                    title: {
                        text: 'Valence'
                    }
                }
            });

            const yearData = {};
            relatedSongs.forEach(song => {
                const year = song.year;
                const explicit = song.explicit==="VERDADERO" ? 'Verdadero' : 'Falso';
                if (!yearData[year]) {
                    yearData[year] = { Verdadero: 0, Falso: 0 };
                }
                yearData[year][explicit]++;
            });

            const labels4 = Object.keys(yearData).sort();
            const seriesVerdadero = [];
            const seriesFalso = [];
            console.log("Related songs:", relatedSongs);

            labels4.forEach(year => {
                seriesVerdadero.push(yearData[year].Verdadero);
                seriesFalso.push(yearData[year].Falso);
            });

            new Chartist.Bar('.ct-chart-d', {
                labels: labels4,
                series: [
                    {name: 'Explícito', data: seriesVerdadero, className: 'bar-explicito'},
                    {name: 'No Explícito', data: seriesFalso, className: 'bar-no-explicito'}
                ]
            }, {
                seriesBarDistance: 15,
                stackBars: false,
                axisX: {
                    offset: 60,
                    title: 'Año'
                },
                axisY: {
                    offset: 80,
                    title: 'Cantidad de Canciones'
                }
            });

        },
        error: function(error) {
            console.error('Error al cargar el archivo CSV:', error);
        }
    });
});

        </script>

<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            Papa.parse("img/DATASET_SPOTIFY.csv", {
               download: true,
                header: true,
                dynamicTyping: true,
                complete: function(results) {
                    const csvData = results.data;
                    console.log(csvData);

                        const emotion = {
                        "danceability": 640,
                        "energy": 500,
                        "key": 5,
                        "loudness": -6.332,
                        "mode": 1,
                        "speechiness": 400,
                        "acousticness": 353,
                        "instrumentalness": 0.00618,
                        "liveness": 770,
                        "valence": 371,
                        "tempo": 100.202
                    };                    

                    const thresholds = {
                        danceability: 200,
                        energy: 300,
                        key: 7,
                        loudness: 10,
                        mode: 1,
                        speechiness: 250,
                        acousticness: 300,
                        instrumentalness: 0.15,
                        liveness:150,
                        valence: 100,
                        tempo: 90
                    };

                    let relatedSongs = csvData.filter(song => {
                        return Object.keys(emotion).every(key => {
                            return Math.abs(parseFloat(song[key]) - emotion[key]) < thresholds[key];
                        });
                    });

                    relatedSongs.sort((a, b) => b.popularity - a.popularity);

    
                    relatedSongs = relatedSongs.slice(0, 10);

                    console.log("Top related songs:", relatedSongs);

                    
                    function fillTopSongsTable(songs) {
                        const tableBody = document.getElementById('topSongsTableBody');
                        tableBody.innerHTML = ''; // Limpiar el contenido actual de la tabla

                        songs.forEach((song, index) => {
                            const row = document.createElement('tr');

                            // Columna #
                            const indexCell = document.createElement('td');
                            indexCell.textContent = index + 1;
                            row.appendChild(indexCell);

                            // Columna Nombre de la Canción
                            const songNameCell = document.createElement('td');
                            const songLink = document.createElement('span');
                            songLink.textContent = song.song; // Nombre de la canción
                            songNameCell.appendChild(songLink);
                            row.appendChild(songNameCell);

                            // Columna Artista
                            const artistCell = document.createElement('td');
                            artistCell.textContent = song.artist;
                            row.appendChild(artistCell);

                            // Agregar la fila a la tabla
                            tableBody.appendChild(row);
                        });
                    }

                    fillTopSongsTable(relatedSongs);
                },
                error: function(error) {
                    console.error('Error al cargar el archivo CSV:', error);
                }
            });
        });
    </script>
</body>
</html>
